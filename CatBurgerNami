local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

local MessageModule = {}

function MessageModule:ShowMessage(text, duration)
	duration = duration or 4

	local screenGui = Instance.new("ScreenGui")
	screenGui.Name = "SapiHubNotificationGui"
	screenGui.ResetOnSpawn = false
	screenGui.Parent = playerGui

	local frame = Instance.new("Frame")
	frame.Size = UDim2.new(0, 200, 0, 44)
	frame.Position = UDim2.new(1, 20, 1, -80)
	frame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
	frame.BorderSizePixel = 0
	frame.AnchorPoint = Vector2.new(0, 0)
	frame.ClipsDescendants = true
	frame.Parent = screenGui

	local corner = Instance.new("UICorner")
	corner.CornerRadius = UDim.new(0, 12)
	corner.Parent = frame

	local border = Instance.new("UIStroke")
	border.Thickness = 2
	border.Color = Color3.fromRGB(0, 170, 255)
	border.Parent = frame

	local shadow = Instance.new("ImageLabel")
	shadow.AnchorPoint = Vector2.new(0.5, 0.5)
	shadow.Position = UDim2.new(0.5, 0, 0.5, 0)
	shadow.Size = UDim2.new(1, 28, 1, 28)
	shadow.BackgroundTransparency = 1
	shadow.Image = "rbxassetid://1316045217"
	shadow.ImageColor3 = Color3.fromRGB(0, 0, 0)
	shadow.ImageTransparency = 1
	shadow.ZIndex = 0
	shadow.Parent = frame

	local glowLabel = Instance.new("TextLabel")
	glowLabel.Size = UDim2.new(1, -20, 1, 0)
	glowLabel.Position = UDim2.new(0, 10, 0, 0)
	glowLabel.BackgroundTransparency = 1
	glowLabel.Text = text
	glowLabel.Font = Enum.Font.GothamSemibold
	glowLabel.TextSize = 16
	glowLabel.TextColor3 = Color3.fromRGB(0, 170, 255)
	glowLabel.TextTransparency = 1
	glowLabel.ZIndex = 1
	glowLabel.TextWrapped = true
	glowLabel.TextScaled = true
	glowLabel.Parent = frame

	local label = Instance.new("TextLabel")
	label.Size = UDim2.new(1, -20, 1, 0)
	label.Position = UDim2.new(0, 10, 0, 0)
	label.BackgroundTransparency = 1
	label.TextColor3 = Color3.fromRGB(255, 255, 255)
	label.Font = Enum.Font.GothamSemibold
	label.TextSize = 16
	label.Text = text
	label.TextTransparency = 1
	label.ZIndex = 2
	label.TextWrapped = true
	label.TextScaled = true
	label.Parent = frame

	local textStroke = Instance.new("UIStroke")
	textStroke.Thickness = 1
	textStroke.Color = Color3.fromRGB(0, 170, 255)
	textStroke.Transparency = 0.6
	textStroke.Parent = label

	local targetPos = UDim2.new(1, -220, 1, -80)
	local outPos = UDim2.new(1, 20, 1, -80)
	TweenService:Create(frame, TweenInfo.new(0.28, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Position = targetPos}):Play()
	TweenService:Create(glowLabel, TweenInfo.new(0.28), {TextTransparency = 0.75}):Play()
	TweenService:Create(label, TweenInfo.new(0.28), {TextTransparency = 0}):Play()
	TweenService:Create(shadow, TweenInfo.new(0.28), {ImageTransparency = 0.7}):Play()

	task.delay(duration, function()
		TweenService:Create(frame, TweenInfo.new(0.28, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {Position = outPos}):Play()
		TweenService:Create(glowLabel, TweenInfo.new(0.2), {TextTransparency = 1}):Play()
		TweenService:Create(label, TweenInfo.new(0.2), {TextTransparency = 1}):Play()
		TweenService:Create(shadow, TweenInfo.new(0.2), {ImageTransparency = 1}):Play()
		task.wait(0.28)
		screenGui:Destroy()
	end)
end

function MessageModule:OpenMenu()
	local AimlockURL = "https://raw.githubusercontent.com/jakasnaam-web/cutebee/refs/heads/main/KitsuneFruit"
	local SilentAimURL = "https://raw.githubusercontent.com/jakasnaam-web/cutebee/refs/heads/main/DragonFruit"
	local AimlockNoFeatures = "https://raw.githubusercontent.com/jakasnaam-web/cutebee/refs/heads/main/LeoFruit"
	local SilentAimNoFeatures = "https://raw.githubusercontent.com/jakasnaam-web/cutebee/refs/heads/main/YetiFruit"
	
	local support = {
		hookmetamethod = typeof(hookmetamethod) == "function",
		hookfunction = typeof(hookfunction) == "function",
		sethiddenproperty = typeof(sethiddenproperty) == "function",
		getrawmetatable = typeof(getrawmetatable) == "function",
		getrenv = typeof(getrenv) == "function",
		httpservice = pcall(function() return game:GetService("HttpService") end),
		getnamecallmethod = typeof(getnamecallmethod) == "function",
		_namecall = _namecall ~= nil,
		_G = _G ~= nil,
		setreadonly = typeof(setreadonly) == "function"
	}

	local executor = "Unknown"
	if getexecutorname then
	    local success, execName = pcall(getexecutorname)
	    if success and type(execName) == "string" then
	        executor = execName
	    end
	end

	local function supportsAll()
		for name, has in pairs(support) do
			if not has then
				return false
			end
		end
		return true
	end

	local function supportsPartial(required)
		for _, name in ipairs(required) do
			if not support[name] then
				return false
			end
		end
		return true
	end

	local function getButtonStatus(mode)
		if mode == "Aimlock" or mode == "SilentAim" then
			return supportsAll() and "Supported" or "Not Supported"
		elseif mode == "AimlockNoFeatures" then
			return supportsPartial({"hookmetamethod"}) and "Supported" or "Not Supported"
		elseif mode == "SilentAimNoFeatures" then
			return supportsPartial({"getrawmetatable"}) and "Supported" or "Not Supported"
		end
	end

	local ScreenGui = Instance.new("ScreenGui")
	ScreenGui.Name = "SapiHubSelectGui"
	ScreenGui.ResetOnSpawn = false
	ScreenGui.Parent = playerGui
	
	local glowTweenInfo = TweenInfo.new(
	  1,
	  Enum.EasingStyle.Sine,
	  Enum.EasingDirection.InOut,
	  -1,
	  true
	)

	local function applyGlow(obj, goal)
	  local tween = TweenService:Create(obj, glowTweenInfo, goal)
	  tween:Play()
	end

	local MainFrame = Instance.new("Frame")
	MainFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
	MainFrame.BackgroundTransparency = 0.1
	MainFrame.BorderSizePixel = 4
	MainFrame.Visible = false
	MainFrame.ClipsDescendants = true
	MainFrame.BorderColor3 = Color3.fromRGB(200, 170, 90)
	MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
	MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
	MainFrame.Parent = ScreenGui

	applyGlow(MainFrame, {BorderColor3 = Color3.fromRGB(255,215,100)})

	local BGImage = Instance.new("ImageLabel")
	BGImage.Size = UDim2.new(0, 147, 0, 246)
	BGImage.BackgroundTransparency = 1
	BGImage.Image = "rbxassetid://113345612181334"
	BGImage.ImageTransparency = 0.35
	BGImage.ScaleType = Enum.ScaleType.Crop
	BGImage.AnchorPoint = Vector2.new(0, 0)
	BGImage.Parent = MainFrame

	MainFrame.Size = BGImage.Size

	local Title = Instance.new("TextLabel")
	Title.Size = UDim2.new(0.667, 0, 0.031, 18)
	Title.Position = UDim2.new(0.163, 0, 0.111, 0)
	Title.BackgroundTransparency = 1
	Title.Text = "Choose Mode"
	Title.Font = Enum.Font.Antique
	Title.TextSize = 10
	Title.TextScaled = true
	Title.TextColor3 = Color3.fromRGB(200, 170, 90)
	Title.Parent = MainFrame
	
	applyGlow(Title, {TextColor3 = Color3.fromRGB(255,215,100)})

	local ButtonHolder = Instance.new("Frame")
	ButtonHolder.Size = UDim2.new(1, 0, 0.853, -40)
	ButtonHolder.Position = UDim2.new(0, 0, 0, 76)
	ButtonHolder.BackgroundTransparency = 1
	ButtonHolder.Parent = MainFrame

	local UIListLayout = Instance.new("UIListLayout")
	UIListLayout.Padding = UDim.new(0, 10)
	UIListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	UIListLayout.VerticalAlignment = Enum.VerticalAlignment.Top
	UIListLayout.Parent = ButtonHolder

	local function CreateButton(name, labelText)
		local btn = Instance.new("TextButton")
		btn.Name = name
		btn.Size = UDim2.new(0, 78, 0, 26)
		btn.BackgroundColor3 = Color3.fromRGB(80, 50, 30)
		btn.Text = labelText
		btn.Font = Enum.Font.GothamSemibold
		btn.BorderColor3 = Color3.fromRGB(200, 170, 90)
		btn.BorderSizePixel = 3
		btn.TextSize = 14
		btn.TextColor3 = Color3.fromRGB(255, 230, 180)
		btn.TextScaled = true
		btn.TextWrapped = true
		btn.Parent = ButtonHolder
		
		applyGlow(btn, {BorderColor3 = Color3.fromRGB(255,215,100)})

		btn.MouseEnter:Connect(function()
			TweenService:Create(btn, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(60, 40, 20)}):Play()
			TweenService:Create(btn, TweenInfo.new(0.15), {BorderColor3 = Color3.fromRGB(255, 255, 255)}):Play()
		end)
		btn.MouseLeave:Connect(function()
			TweenService:Create(btn, TweenInfo.new(0.15), {BackgroundColor3 = Color3.fromRGB(80, 50, 30)}):Play()
			TweenService:Create(btn, TweenInfo.new(0.15), {BorderColor3 = Color3.fromRGB(200, 170, 90)}):Play()
		end)

		return btn
	end

	local AimlockButton = CreateButton("AimlockButton", "Aimlock")
	local SilentAimButton = CreateButton("SilentAimButton", "Silent Aim")
	local AimlockNoFeaturesButton = CreateButton("AimlockNoFeaturesButton", "Aimlock (No Features)")
	local SilentAimNoFeaturesButton = CreateButton("SilentAimNoFeaturesButton", "Silent Aim (No Features)")
	
	AimlockButton.Text = "Aimlock\n" .. executor .. ": " .. getButtonStatus("Aimlock")
	SilentAimButton.Text = "Silent Aim\n" .. executor .. ": " .. getButtonStatus("SilentAim")
	AimlockNoFeaturesButton.Text = "Aimlock (No Features)\n" .. executor .. ": " .. getButtonStatus("AimlockNoFeatures")
	SilentAimNoFeaturesButton.Text = "Silent Aim (No Features)\n" .. executor .. ": " .. getButtonStatus("SilentAimNoFeatures")

	MainFrame.Visible = true
	MainFrame.Size = UDim2.new(0, 0, 0, 0)
	TweenService:Create(MainFrame, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {
		Size = BGImage.Size
	}):Play()
	
	AimlockButton.MouseButton1Click:Connect(function()
		MessageModule:ShowMessage("Loading Aimlock...", 3)
		MainFrame:Destroy()
		local success, err = pcall(function()
			local AimlockList = loadstring(game:HttpGet(AimlockURL))()
			local gameId = game.PlaceId
			local scriptUrl = AimlockList[gameId]
			if scriptUrl then
				loadstring(game:HttpGet(scriptUrl))()
			else
				MessageModule:ShowMessage("Unsupported Game!", 3)
			end
		end)
		if not success then warn("Aimlock failed:", err) end
	end)
	
	AimlockNoFeaturesButton.MouseButton1Click:Connect(function()
		MessageModule:ShowMessage("Loading Aimlock(NoFeatures)...", 3)
		MainFrame:Destroy()
		local success, err = pcall(function()
			local AimlockNoFeaturesList = loadstring(game:HttpGet(AimlockNoFeatures))()
			local gameId = game.PlaceId
			local scriptUrl = AimlockNoFeaturesList[gameId]
			if scriptUrl then
				loadstring(game:HttpGet(scriptUrl))()
			else
				MessageModule:ShowMessage("Unsupported Game!", 3)
			end
		end)
		if not success then warn("AimlockNoFeatures failed:", err) end
	end)

	SilentAimButton.MouseButton1Click:Connect(function()
		MessageModule:ShowMessage("Loading SilentAim...", 3)
		MainFrame:Destroy()
		local success, err = pcall(function()
			local SilentAimList = loadstring(game:HttpGet(SilentAimURL))()
			local gameId = game.PlaceId
			local scriptUrl = SilentAimList[gameId]
			if scriptUrl then
				loadstring(game:HttpGet(scriptUrl))()
			else
				MessageModule:ShowMessage("Unsupported Game!", 3)
			end
		end)
		if not success then warn("SilentAim failed:", err) end
	end)
	
	SilentAimNoFeaturesButton.MouseButton1Click:Connect(function()
		MessageModule:ShowMessage("Loading SilentAim(NoFeatures)...", 3)
		MainFrame:Destroy()
		local success, err = pcall(function()
			local SilentAimNoFeaturesList = loadstring(game:HttpGet(SilentAimNoFeatures))()
			local gameId = game.PlaceId
			local scriptUrl = SilentAimNoFeaturesList[gameId]
			if scriptUrl then
				loadstring(game:HttpGet(scriptUrl))()
			else
				MessageModule:ShowMessage("Unsupported Game!", 3)
			end
		end)
		if not success then warn("SilentAimNoFeatures failed:", err) end
	end)
end

return MessageModule
