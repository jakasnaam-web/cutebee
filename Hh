-- Closest-target aimbot (no FOV UI)
Playersaimbot = nil
PlayersPosition = nil

local Players = game:GetService("Players")
local localPlayer = Players.LocalPlayer
local currentCamera = workspace.CurrentCamera
local RunService = game:GetService("RunService")

-- Remove any old UI named 'infoplayers' (optional)
pcall(function()
    local core = game:GetService("CoreGui")
    if core:FindFirstChild("infoplayers") then
        core.infoplayers:Destroy()
    end
end)

-- Helper: safe check for a player's valid HRP
local function getHRP(player)
    if not player or not player.Character then return nil end
    local hrp = player.Character:FindFirstChild("HumanoidRootPart")
    return hrp
end

-- Select the closest valid target to local player (within maxRange)
local maxRange = 1000

RunService.Heartbeat:Connect(function()
    local ok, lpChar = pcall(function() return localPlayer.Character end)
    if not ok or not lpChar then return end
    local lpHRP = lpChar:FindFirstChild("HumanoidRootPart")
    if not lpHRP then return end

    local closestPlayer = nil
    local closestDist = math.huge
    -- iterate players and pick the nearest (excluding local player)
    for _, pl in ipairs(Players:GetPlayers()) do
        if pl ~= localPlayer and pl.Character and pl.Character.Parent ~= nil then
            local hrp = getHRP(pl)
            if hrp then
                local dist = (hrp.Position - lpHRP.Position).Magnitude
                if dist <= maxRange and dist < closestDist then
                    closestDist = dist
                    closestPlayer = pl
                end
            end
        end
    end

    if closestPlayer then
        Playersaimbot = closestPlayer.Name
        local hrp = getHRP(closestPlayer)
        if hrp then
            PlayersPosition = hrp.Position
        else
            PlayersPosition = nil
        end
    else
        Playersaimbot = nil
        PlayersPosition = nil
    end
end)

-- Keep PlayersPosition updated (in case target moves)
RunService.Heartbeat:Connect(function()
    if Playersaimbot then
        local pl = Players:FindFirstChild(Playersaimbot)
        if pl and pl.Character then
            local hrp = pl.Character:FindFirstChild("HumanoidRootPart")
            if hrp then
                PlayersPosition = hrp.Position
            else
                PlayersPosition = nil
            end
        else
            PlayersPosition = nil
        end
    end
end)

-- Hook namecall to replace coordinates sent to remotes (user-provided approach)
-- Note: modifying metatable may be blocked or risky on some environments.
spawn(function()
    local success, gg = pcall(function() return getrawmetatable(game) end)
    if not success or not gg then return end

    local old = gg.__namecall
    if not old then return end

    setreadonly(gg, false)
    gg.__namecall = newcclosure(function(...)
        local method = getnamecallmethod()
        local args = {...}
        -- adjust this logic for the exact remote signature your game uses
        if tostring(method) == "FireServer" and PlayersPosition ~= nil then
            -- many games use RemoteEvent/RemoteFunction objects - user code expected args[1] to be the remote type/name
            -- this preserves other calls but attempts to replace coordinate-like arg with PlayersPosition
            -- Only override if the second arg is not "true"/"false" per original script
            if tostring(args[1]) == "RemoteEvent" then
                if tostring(args[2]) ~= "true" and tostring(args[2]) ~= "false" then
                    -- replace argument (index 2 in original script) with our target position
                    -- be conservative: only override if PlayersPosition is set
                    args[2] = PlayersPosition
                    return old(unpack(args))
                end
            end
        end
        return old(...)
    end)
    setreadonly(gg, true)
end)

-- Mouse click: invoke the tool's remote shoot function (if present)
local mouse = localPlayer:GetMouse()
mouse.Button1Down:Connect(function()
    pcall(function()
        if Playersaimbot ~= nil and PlayersPosition ~= nil then
            local tool = localPlayer.Character and localPlayer.Character:FindFirstChildOfClass("Tool")
            if tool and tool:FindFirstChild("RemoteFunctionShoot") and tool.RemoteFunctionShoot:IsA("RemoteFunction") then
                local targetPl = Players:FindFirstChild(Playersaimbot)
                if targetPl and targetPl.Character then
                    local hrp = targetPl.Character:FindFirstChild("HumanoidRootPart")
                    if hrp then
                        local args = {
                            [1] = PlayersPosition,
                            [2] = hrp
                        }
                        -- safe invoke
                        local success, res = pcall(function()
                            return tool.RemoteFunctionShoot:InvokeServer(unpack(args))
                        end)
                        -- ignore result; we used pcall to avoid runtime errors
                    end
                end
            end
        end
    end)
end)
